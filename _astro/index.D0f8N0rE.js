const m={},d=new Set,s=new WeakSet;let f=!0,h="hover",l=!1;function T(e){l||(l=!0,f??=e?.prefetchAll??!1,h??=e?.defaultStrategy??"hover",v(),g(),y(),S())}function v(){for(const e of["touchstart","mousedown"])document.addEventListener(e,t=>{a(t.target,"tap")&&c(t.target.href,{ignoreSlowConnection:!0})},{passive:!0})}function g(){let e;document.body.addEventListener("focusin",r=>{a(r.target,"hover")&&t(r)},{passive:!0}),document.body.addEventListener("focusout",n,{passive:!0}),u(()=>{for(const r of document.getElementsByTagName("a"))s.has(r)||a(r,"hover")&&(s.add(r),r.addEventListener("mouseenter",t,{passive:!0}),r.addEventListener("mouseleave",n,{passive:!0}))});function t(r){const o=r.target.href;e&&clearTimeout(e),e=setTimeout(()=>{c(o)},80)}function n(){e&&(clearTimeout(e),e=0)}}function y(){let e;u(()=>{for(const t of document.getElementsByTagName("a"))s.has(t)||a(t,"viewport")&&(s.add(t),e??=w(),e.observe(t))})}function w(){const e=new WeakMap;return new IntersectionObserver((t,n)=>{for(const r of t){const o=r.target,i=e.get(o);r.isIntersecting?(i&&clearTimeout(i),e.set(o,setTimeout(()=>{n.unobserve(o),e.delete(o),c(o.href)},300))):i&&(clearTimeout(i),e.delete(o))}})}function S(){u(()=>{for(const e of document.getElementsByTagName("a"))a(e,"load")&&c(e.href)})}function c(e,t){e=e.replace(/#.*/,"");const n=t?.ignoreSlowConnection??!1;if(E(e,n))if(d.add(e),HTMLScriptElement.supports?.("speculationrules"))L(e,t?.eagerness??"immediate");else if(document.createElement("link").relList?.supports?.("prefetch")&&t?.with!=="fetch"){const r=document.createElement("link");r.rel="prefetch",r.setAttribute("href",e),document.head.append(r)}else{const r=new Headers;for(const[o,i]of Object.entries(m))r.set(o,i);fetch(e,{priority:"low",headers:r})}}function E(e,t){if(!navigator.onLine||!t&&p())return!1;try{const n=new URL(e,location.href);return location.origin===n.origin&&(location.pathname!==n.pathname||location.search!==n.search)&&!d.has(e)}catch{}return!1}function a(e,t){if(e?.tagName!=="A")return!1;const n=e.dataset.astroPrefetch;return n==="false"?!1:t==="tap"&&(n!=null||f)&&p()?!0:n==null&&f||n===""?t===h:n===t}function p(){if("connection"in navigator){const e=navigator.connection;return e.saveData||/2g/.test(e.effectiveType)}return!1}function u(e){e();let t=!1;document.addEventListener("astro:page-load",()=>{if(!t){t=!0;return}e()})}function L(e,t){const n=document.createElement("script");n.type="speculationrules",n.textContent=JSON.stringify({prerender:[{source:"list",urls:[e],eagerness:t}],prefetch:[{source:"list",urls:[e],eagerness:t}]}),document.head.append(n)}export{T as a,m as i};
